# 钉钉考勤导入模板说明

## 钉钉考勤数据导出步骤

1. 登录钉钉管理后台
2. 进入「工作台」→「考勤打卡」
3. 选择「考勤统计」→「明细数据」
4. 设置查询条件：
   - 选择部门和人员
   - 设置日期范围
   - 选择导出格式为Excel
5. 点击「导出」按钮下载考勤数据

## 支持的钉钉考勤字段映射

### 标准字段映射表

| 钉钉字段名 | 系统字段名 | 数据类型 | 是否必填 | 说明 |
|------------|------------|----------|----------|------|
| 姓名 | EmployeeName | 文本 | 是 | 员工姓名，用于匹配员工信息 |
| 工号 | EmployeeCode | 文本 | 是 | 员工工号，优先使用工号匹配 |
| 部门 | Department | 文本 | 否 | 部门名称 |
| 日期 | AttendanceDate | 日期 | 是 | 考勤日期，格式：YYYY-MM-DD |
| 上班时间 | PunchInTime | 时间 | 否 | 上班打卡时间，格式：HH:MM |
| 下班时间 | PunchOutTime | 时间 | 否 | 下班打卡时间，格式：HH:MM |
| 考勤状态 | Status | 文本 | 是 | 考勤状态 |
| 迟到时长(分钟) | LateMinutes | 数值 | 否 | 迟到分钟数 |
| 早退时长(分钟) | EarlyLeaveMinutes | 数值 | 否 | 早退分钟数 |
| 缺卡次数 | MissedPunches | 数值 | 否 | 缺卡次数 |
| 加班时长(小时) | OvertimeHours | 数值 | 否 | 加班小时数 |
| 请假时长(小时) | LeaveHours | 数值 | 否 | 请假小时数 |
| 出勤时长(小时) | WorkHours | 数值 | 否 | 实际出勤小时数 |
| 备注 | Remarks | 文本 | 否 | 考勤备注信息 |

### 考勤状态映射规则

| 钉钉状态 | 系统状态 | 说明 |
|----------|----------|------|
| 正常 | 正常 | 正常出勤 |
| 迟到 | 迟到 | 上班迟到 |
| 早退 | 早退 | 下班早退 |
| 旷工 | 缺勤 | 无故缺勤 |
| 缺卡 | 缺勤 | 忘记打卡 |
| 请假 | 请假 | 各类请假 |
| 出差 | 出差 | 出差外勤 |
| 外出 | 外出 | 外出办事 |
| 加班 | 加班 | 加班工作 |

## 自定义字段映射配置

如果您的钉钉导出字段与标准字段不同，可以在软件中进行自定义映射配置：

### 配置步骤

1. 在软件主界面选择「数据导入」→「钉钉考勤导入」
2. 点击「字段映射配置」按钮
3. 在弹出的配置窗口中设置字段对应关系
4. 保存配置后进行数据导入

### 配置示例

```json
{
  "fieldMapping": {
    "员工姓名": "EmployeeName",
    "员工编号": "EmployeeCode",
    "考勤日期": "AttendanceDate",
    "上班打卡": "PunchInTime",
    "下班打卡": "PunchOutTime",
    "考勤结果": "Status",
    "迟到(分钟)": "LateMinutes",
    "早退(分钟)": "EarlyLeaveMinutes",
    "加班(小时)": "OvertimeHours"
  }
}
```

## 数据处理规则

### 1. 员工匹配规则

- 优先使用员工工号进行匹配
- 如果工号为空或匹配失败，使用员工姓名匹配
- 如果姓名也匹配失败，记录为导入错误

### 2. 考勤异常处理

- **迟到处理**：迟到时长超过设定阈值（默认30分钟）计为考勤异常
- **早退处理**：早退时长超过设定阈值（默认30分钟）计为考勤异常
- **缺勤处理**：旷工、缺卡状态直接计为缺勤
- **请假处理**：请假状态不计入考勤异常，但影响全勤奖

### 3. 加班时间计算

- **工作日加班**：超过标准工作时间的部分按1.5倍计算
- **周末加班**：周末工作时间按2倍计算
- **法定节假日加班**：按3倍计算（需手动标记）

### 4. 全勤判定规则

满足以下条件视为全勤：
- 无缺勤记录
- 迟到次数不超过设定阈值（默认2次）
- 早退次数不超过设定阈值（默认2次）
- 请假时长不超过设定阈值（默认4小时）

## 导入注意事项

1. **文件格式**：支持Excel格式(.xlsx)和CSV格式(.csv)
2. **编码格式**：CSV文件请使用UTF-8编码
3. **日期格式**：支持多种日期格式，系统会自动识别
4. **时间格式**：支持HH:MM和HH:MM:SS格式
5. **数据完整性**：确保员工工号或姓名能够正确匹配系统中的员工信息
6. **重复数据**：同一员工同一天的重复记录会被自动去重，保留最后一条

## 错误处理和日志

### 常见错误类型

1. **员工匹配失败**：工号或姓名在系统中不存在
2. **日期格式错误**：日期格式不符合要求
3. **数据类型错误**：数值字段包含非数字字符
4. **必填字段缺失**：必填字段为空

### 错误处理方式

- 导入过程中会生成详细的错误日志
- 错误记录会单独列出，可以手动修正后重新导入
- 成功导入的记录不受错误记录影响

## 批量导入建议

1. **分批导入**：建议按月份分批导入，避免单次导入数据量过大
2. **数据备份**：导入前建议备份现有数据
3. **测试导入**：首次使用建议先用少量数据测试
4. **定期导入**：建议每月定期导入考勤数据，保持数据时效性

## 示例文件

请参考templates目录下的示例文件：
- `钉钉考勤导入示例.xlsx`
- `钉钉考勤字段映射配置示例.json`